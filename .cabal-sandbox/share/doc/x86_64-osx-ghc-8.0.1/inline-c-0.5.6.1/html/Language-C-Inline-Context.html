<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Language.C.Inline.Context</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Language-C-Inline-Context.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">inline-c-0.5.6.1: Write Haskell source files including C code inline. No FFI required.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Language.C.Inline.Context</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1"><code>TypesTable</code></a></li><li><a href="#g:2"><code>AntiQuoter</code></a></li><li><a href="#g:3"><code>Context</code></a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>A <code><a href="Language-C-Inline-Context.html#t:Context">Context</a></code> is used to define the capabilities of the Template Haskell code
 that handles the inline C code. See the documentation of the data type for
 more details.</p><p>In practice, a <code><a href="Language-C-Inline-Context.html#t:Context">Context</a></code> will have to be defined for each library that
 defines new C types, to allow the TemplateHaskell code to interpret said
 types correctly.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">type</span> <a href="#t:TypesTable">TypesTable</a> = <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/containers-0.5.7.1/Data-Map-Strict.html#t:Map">Map</a> <a href="Language-C-Types.html#t:TypeSpecifier">TypeSpecifier</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Lib.html#t:TypeQ">TypeQ</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:Purity">Purity</a><ul class="subs"><li>= <a href="#v:Pure">Pure</a></li><li>| <a href="#v:IO">IO</a></li></ul></li><li class="src short"><a href="#v:convertType">convertType</a> :: <a href="Language-C-Inline-Context.html#t:Purity">Purity</a> -&gt; <a href="Language-C-Inline-Context.html#t:TypesTable">TypesTable</a> -&gt; <a href="Language-C-Types.html#t:Type">Type</a> <a href="Language-C-Types-Parse.html#t:CIdentifier">CIdentifier</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#t:Q">Q</a> (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#t:Type">Type</a>)</li><li class="src short"><span class="keyword">type</span> <a href="#t:CArray">CArray</a> = <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-Ptr.html#t:Ptr">Ptr</a></li><li class="src short"><a href="#v:typeNamesFromTypesTable">typeNamesFromTypesTable</a> :: <a href="Language-C-Inline-Context.html#t:TypesTable">TypesTable</a> -&gt; <a href="Language-C-Types-Parse.html#t:TypeNames">TypeNames</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:AntiQuoter">AntiQuoter</a> a = <a href="#v:AntiQuoter">AntiQuoter</a> {<ul class="subs"><li><a href="#v:aqParser">aqParser</a> :: <span class="keyword">forall</span> m. <a href="Language-C-Types-Parse.html#t:CParser">CParser</a> <a href="Language-C-Inline-HaskellIdentifier.html#t:HaskellIdentifier">HaskellIdentifier</a> m =&gt; m (<a href="Language-C-Types-Parse.html#t:CIdentifier">CIdentifier</a>, <a href="Language-C-Types.html#t:Type">Type</a> <a href="Language-C-Types-Parse.html#t:CIdentifier">CIdentifier</a>, a)</li><li><a href="#v:aqMarshaller">aqMarshaller</a> :: <a href="Language-C-Inline-Context.html#t:Purity">Purity</a> -&gt; <a href="Language-C-Inline-Context.html#t:TypesTable">TypesTable</a> -&gt; <a href="Language-C-Types.html#t:Type">Type</a> <a href="Language-C-Types-Parse.html#t:CIdentifier">CIdentifier</a> -&gt; a -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#t:Q">Q</a> (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#t:Type">Type</a>, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#t:Exp">Exp</a>)</li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:AntiQuoterId">AntiQuoterId</a> = <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-String.html#t:String">String</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:SomeAntiQuoter">SomeAntiQuoter</a> = (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Eq.html#t:Eq">Eq</a> a, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="#v:SomeAntiQuoter">SomeAntiQuoter</a> (<a href="Language-C-Inline-Context.html#t:AntiQuoter">AntiQuoter</a> a)</li><li class="src short"><span class="keyword">type</span> <a href="#t:AntiQuoters">AntiQuoters</a> = <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/containers-0.5.7.1/Data-Map-Strict.html#t:Map">Map</a> <a href="Language-C-Inline-Context.html#t:AntiQuoterId">AntiQuoterId</a> <a href="Language-C-Inline-Context.html#t:SomeAntiQuoter">SomeAntiQuoter</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:Context">Context</a> = <a href="#v:Context">Context</a> {<ul class="subs"><li><a href="#v:ctxTypesTable">ctxTypesTable</a> :: <a href="Language-C-Inline-Context.html#t:TypesTable">TypesTable</a></li><li><a href="#v:ctxAntiQuoters">ctxAntiQuoters</a> :: <a href="Language-C-Inline-Context.html#t:AntiQuoters">AntiQuoters</a></li><li><a href="#v:ctxFileExtension">ctxFileExtension</a> :: <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-String.html#t:String">String</a></li><li><a href="#v:ctxOutput">ctxOutput</a> :: <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-String.html#t:String">String</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-String.html#t:String">String</a>)</li></ul>}</li><li class="src short"><a href="#v:baseCtx">baseCtx</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a></li><li class="src short"><a href="#v:fptrCtx">fptrCtx</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a></li><li class="src short"><a href="#v:funCtx">funCtx</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a></li><li class="src short"><a href="#v:vecCtx">vecCtx</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a></li><li class="src short"><span class="keyword">class</span> <a href="#t:VecCtx">VecCtx</a> a <span class="keyword">where</span><ul class="subs"><li><span class="keyword">type</span> <a href="#t:VecCtxScalar">VecCtxScalar</a> a :: <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Kind.html#t:-42-">*</a></li></ul></li><li class="src short"><a href="#v:bsCtx">bsCtx</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a></li></ul></div><div id="interface"><h1 id="g:1"><code><a href="Language-C-Inline-Context.html#t:TypesTable">TypesTable</a></code></h1><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:TypesTable" class="def">TypesTable</a> = <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/containers-0.5.7.1/Data-Map-Strict.html#t:Map">Map</a> <a href="Language-C-Types.html#t:TypeSpecifier">TypeSpecifier</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Lib.html#t:TypeQ">TypeQ</a> <a href="#t:TypesTable" class="selflink">#</a></p><div class="doc"><p>A mapping from <code><a href="Language-C-Types.html#t:TypeSpecifier">TypeSpecifier</a></code>s to Haskell types.  Needed both to
 parse C types, and to convert them to Haskell types.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Purity" class="def">Purity</a> <a href="#t:Purity" class="selflink">#</a></p><div class="doc"><p>A data type to indicate whether the user requested pure or IO
 function from Haskell</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Pure" class="def">Pure</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:IO" class="def">IO</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:Purity" class="caption collapser" onclick="toggleSection('i:Purity')">Instances</p><div id="section.i:Purity" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Purity:Eq:1" class="instance expander" onclick="toggleSection('i:id:Purity:Eq:1')"></span> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Eq.html#t:Eq">Eq</a> <a href="Language-C-Inline-Context.html#t:Purity">Purity</a></span> <a href="#t:Purity" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Purity:Eq:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Language-C-Inline-Context.html#t:Purity">Purity</a> -&gt; <a href="Language-C-Inline-Context.html#t:Purity">Purity</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Language-C-Inline-Context.html#t:Purity">Purity</a> -&gt; <a href="Language-C-Inline-Context.html#t:Purity">Purity</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Purity:Show:2" class="instance expander" onclick="toggleSection('i:id:Purity:Show:2')"></span> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Text-Show.html#t:Show">Show</a> <a href="Language-C-Inline-Context.html#t:Purity">Purity</a></span> <a href="#t:Purity" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Purity:Show:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Language-C-Inline-Context.html#t:Purity">Purity</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Language-C-Inline-Context.html#t:Purity">Purity</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-String.html#t:String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Language-C-Inline-Context.html#t:Purity">Purity</a>] -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><a id="v:convertType" class="def">convertType</a> :: <a href="Language-C-Inline-Context.html#t:Purity">Purity</a> -&gt; <a href="Language-C-Inline-Context.html#t:TypesTable">TypesTable</a> -&gt; <a href="Language-C-Types.html#t:Type">Type</a> <a href="Language-C-Types-Parse.html#t:CIdentifier">CIdentifier</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#t:Q">Q</a> (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#t:Type">Type</a>) <a href="#v:convertType" class="selflink">#</a></p><div class="doc"><p>Given a <code><a href="Language-C-Inline-Context.html#t:Context">Context</a></code>, it uses its <code><a href="Language-C-Inline-Context.html#v:ctxTypesTable">ctxTypesTable</a></code> to convert
 arbitrary C types.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:CArray" class="def">CArray</a> = <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-Ptr.html#t:Ptr">Ptr</a> <a href="#t:CArray" class="selflink">#</a></p><div class="doc"><p>An alias for <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-Ptr.html#t:Ptr">Ptr</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:typeNamesFromTypesTable" class="def">typeNamesFromTypesTable</a> :: <a href="Language-C-Inline-Context.html#t:TypesTable">TypesTable</a> -&gt; <a href="Language-C-Types-Parse.html#t:TypeNames">TypeNames</a> <a href="#v:typeNamesFromTypesTable" class="selflink">#</a></p></div><h1 id="g:2"><code><a href="Language-C-Inline-Context.html#t:AntiQuoter">AntiQuoter</a></code></h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:AntiQuoter" class="def">AntiQuoter</a> a <a href="#t:AntiQuoter" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:AntiQuoter" class="def">AntiQuoter</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:aqParser" class="def">aqParser</a> :: <span class="keyword">forall</span> m. <a href="Language-C-Types-Parse.html#t:CParser">CParser</a> <a href="Language-C-Inline-HaskellIdentifier.html#t:HaskellIdentifier">HaskellIdentifier</a> m =&gt; m (<a href="Language-C-Types-Parse.html#t:CIdentifier">CIdentifier</a>, <a href="Language-C-Types.html#t:Type">Type</a> <a href="Language-C-Types-Parse.html#t:CIdentifier">CIdentifier</a>, a)</dfn><div class="doc"><p>Parses the body of the antiquotation, returning a hint for the name to
 assign to the variable that will replace the anti-quotation, the type of
 said variable, and some arbitrary data which will then be fed to
 <code><a href="Language-C-Inline-Context.html#v:aqMarshaller">aqMarshaller</a></code>.</p><p>The <code><a href="Language-C-Types.html#t:Type">Type</a></code> has <code>Void</code> as an identifier type to make sure that
 no names appear in it.</p></div></li><li><dfn class="src"><a id="v:aqMarshaller" class="def">aqMarshaller</a> :: <a href="Language-C-Inline-Context.html#t:Purity">Purity</a> -&gt; <a href="Language-C-Inline-Context.html#t:TypesTable">TypesTable</a> -&gt; <a href="Language-C-Types.html#t:Type">Type</a> <a href="Language-C-Types-Parse.html#t:CIdentifier">CIdentifier</a> -&gt; a -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#t:Q">Q</a> (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#t:Type">Type</a>, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#t:Exp">Exp</a>)</dfn><div class="doc"><p>Takes the requested purity, the current <code><a href="Language-C-Inline-Context.html#t:TypesTable">TypesTable</a></code>, and the
 type and the body returned by <code><a href="Language-C-Inline-Context.html#v:aqParser">aqParser</a></code>.</p><p>Returns the Haskell type for the parameter, and the Haskell expression
 that will be passed in as the parameter.</p><p>If the the type returned is <code>ty</code>, the <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/template-haskell-2.11.0.0/Language-Haskell-TH-Syntax.html#t:Exp">Exp</a></code> <strong>must</strong> have type <code>forall
 a. (ty -&gt; IO a) -&gt; IO a</code>. This allows to do resource handling when
 preparing C values.</p><p>Care must be taken regarding <code><a href="Language-C-Inline-Context.html#t:Purity">Purity</a></code>. Specifically, the generated IO
 computation must be idempotent to guarantee its safety when used in pure
 code. We cannot prevent the IO computation from being inlined, hence
 potentially duplicated. If non-idempotent marshallers are required (e.g.
 if an update to some global state is needed), it is best to throw an
 error when <code><a href="Language-C-Inline-Context.html#t:Purity">Purity</a></code> is <code><a href="Language-C-Inline-Context.html#v:Pure">Pure</a></code> (for example &quot;you cannot use context X with
 <code>pure</code>&quot;), which will show up at compile time.</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:AntiQuoterId" class="def">AntiQuoterId</a> = <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-String.html#t:String">String</a> <a href="#t:AntiQuoterId" class="selflink">#</a></p><div class="doc"><p>An identifier for a <code><a href="Language-C-Inline-Context.html#t:AntiQuoter">AntiQuoter</a></code>.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SomeAntiQuoter" class="def">SomeAntiQuoter</a> <a href="#t:SomeAntiQuoter" class="selflink">#</a></p><div class="doc"><p>Existential wrapper around <code><a href="Language-C-Inline-Context.html#t:AntiQuoter">AntiQuoter</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src">(<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Eq.html#t:Eq">Eq</a> a, <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a id="v:SomeAntiQuoter" class="def">SomeAntiQuoter</a> (<a href="Language-C-Inline-Context.html#t:AntiQuoter">AntiQuoter</a> a)</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:AntiQuoters" class="def">AntiQuoters</a> = <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/containers-0.5.7.1/Data-Map-Strict.html#t:Map">Map</a> <a href="Language-C-Inline-Context.html#t:AntiQuoterId">AntiQuoterId</a> <a href="Language-C-Inline-Context.html#t:SomeAntiQuoter">SomeAntiQuoter</a> <a href="#t:AntiQuoters" class="selflink">#</a></p></div><h1 id="g:3"><code><a href="Language-C-Inline-Context.html#t:Context">Context</a></code></h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Context" class="def">Context</a> <a href="#t:Context" class="selflink">#</a></p><div class="doc"><p>A <code><a href="Language-C-Inline-Context.html#t:Context">Context</a></code> stores various information needed to produce the files with
 the C code derived from the inline C snippets.</p><p><code><a href="Language-C-Inline-Context.html#t:Context">Context</a></code>s can be composed with their <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Monoid.html#t:Monoid">Monoid</a></code> instance, where <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Monoid.html#v:mappend">mappend</a></code> is
 right-biased -- in <code><code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Monoid.html#v:mappend">mappend</a></code> x y</code> <code>y</code> will take precedence over <code>x</code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Context" class="def">Context</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:ctxTypesTable" class="def">ctxTypesTable</a> :: <a href="Language-C-Inline-Context.html#t:TypesTable">TypesTable</a></dfn><div class="doc"><p>Needed to convert C types to Haskell types.</p></div></li><li><dfn class="src"><a id="v:ctxAntiQuoters" class="def">ctxAntiQuoters</a> :: <a href="Language-C-Inline-Context.html#t:AntiQuoters">AntiQuoters</a></dfn><div class="doc"><p>Needed to parse and process antiquotations.</p></div></li><li><dfn class="src"><a id="v:ctxFileExtension" class="def">ctxFileExtension</a> :: <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-String.html#t:String">String</a></dfn><div class="doc"><p>Will determine the extension of the file containing the inline
 C snippets.</p></div></li><li><dfn class="src"><a id="v:ctxOutput" class="def">ctxOutput</a> :: <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-String.html#t:String">String</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-String.html#t:String">String</a>)</dfn><div class="doc"><p>This function is used to post-process the functions generated
 from the C snippets.  Currently just used to specify C linkage
 when generating C++ code.</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><p id="control.i:Context" class="caption collapser" onclick="toggleSection('i:Context')">Instances</p><div id="section.i:Context" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Context:Monoid:1" class="instance expander" onclick="toggleSection('i:id:Context:Monoid:1')"></span> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Monoid.html#t:Monoid">Monoid</a> <a href="Language-C-Inline-Context.html#t:Context">Context</a></span> <a href="#t:Context" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Context:Monoid:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:mempty">mempty</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a> <a href="#v:mempty" class="selflink">#</a></p><p class="src"><a href="#v:mappend">mappend</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a> -&gt; <a href="Language-C-Inline-Context.html#t:Context">Context</a> -&gt; <a href="Language-C-Inline-Context.html#t:Context">Context</a> <a href="#v:mappend" class="selflink">#</a></p><p class="src"><a href="#v:mconcat">mconcat</a> :: [<a href="Language-C-Inline-Context.html#t:Context">Context</a>] -&gt; <a href="Language-C-Inline-Context.html#t:Context">Context</a> <a href="#v:mconcat" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><a id="v:baseCtx" class="def">baseCtx</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a> <a href="#v:baseCtx" class="selflink">#</a></p><div class="doc"><p>Context useful to work with vanilla C. Used by default.</p><p><code><a href="Language-C-Inline-Context.html#v:ctxTypesTable">ctxTypesTable</a></code>: converts C basic types to their counterparts in
 <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-C-Types.html">Foreign.C.Types</a>.</p><p>No <code><a href="Language-C-Inline-Context.html#v:ctxAntiQuoters">ctxAntiQuoters</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:fptrCtx" class="def">fptrCtx</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a> <a href="#v:fptrCtx" class="selflink">#</a></p><div class="doc"><p>This <code><a href="Language-C-Inline-Context.html#t:Context">Context</a></code> adds support for <code>ForeignPtr</code> arguments. It adds a unique
 marshaller called <code>fptr-ptr</code>. For example, <code>$fptr-ptr:$(int *x)</code> extracts the
 bare C pointer out of foreign pointer <code>x</code>.</p></div></div><div class="top"><p class="src"><a id="v:funCtx" class="def">funCtx</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a> <a href="#v:funCtx" class="selflink">#</a></p><div class="doc"><p>This <code><a href="Language-C-Inline-Context.html#t:Context">Context</a></code> includes a <code><a href="Language-C-Inline-Context.html#t:AntiQuoter">AntiQuoter</a></code> that removes the need for
 explicitely creating <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-Ptr.html#t:FunPtr">FunPtr</a></code>s, named <code>&quot;fun&quot;</code>.</p><p>For example, we can capture function <code>f</code> of type <code>CInt -&gt; CInt -&gt; IO
 CInt</code> in C code using <code>$fun:(int (*f)(int, int))</code>.</p><p>When used in a <code>pure</code> embedding, the Haskell function will have to be
 pure too.  Continuing the example above we'll have <code>CInt -&gt; CInt -&gt;
 IO CInt</code>.</p><p>Does not include the <code><a href="Language-C-Inline-Context.html#v:baseCtx">baseCtx</a></code>, since most of the time it's going to
 be included as part of larger contexts.</p><p>IMPORTANT: When using the <code>fun</code> anti quoter, one must be aware that
 the function pointer which is automatically generated is freed when
 the code contained in the block containing the anti quoter exits.
 Thus, if you need the function pointer to be longer-lived, you must
 allocate it and free it manually using <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-Ptr.html#v:freeHaskellFunPtr">freeHaskellFunPtr</a></code>.
 We provide utilities to easily
 allocate them (see <code><a href="Language-C-Inline.html#v:mkFunPtr">mkFunPtr</a></code>).</p></div></div><div class="top"><p class="src"><a id="v:vecCtx" class="def">vecCtx</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a> <a href="#v:vecCtx" class="selflink">#</a></p><div class="doc"><p>This <code><a href="Language-C-Inline-Context.html#t:Context">Context</a></code> includes two <code><a href="Language-C-Inline-Context.html#t:AntiQuoter">AntiQuoter</a></code>s that allow to easily use
 Haskell vectors in C.</p><p>Specifically, the <code>vec-len</code> and <code>vec-ptr</code> will get the length and the
 pointer underlying mutable (<code><a href="V.html#v:IOVector">IOVector</a></code>) and immutable (<code><a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable.html#t:Vector">Vector</a></code>)
 storable vectors.</p><p>Note that if you use <code><a href="Language-C-Inline-Context.html#v:vecCtx">vecCtx</a></code> to manipulate immutable vectors you
 must make sure that the vector is not modified in the C code.</p><p>To use <code>vec-len</code>, simply write <code>$vec-len:x</code>, where <code>x</code> is something
 of type <code><code><a href="V.html#v:IOVector">IOVector</a></code> a</code> or <code><code><a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable.html#t:Vector">Vector</a></code> a</code>, for some <code>a</code>.  To use
 <code>vec-ptr</code> you need to specify the type of the pointer,
 e.g. <code>$vec-len:(int *x)</code> will work if <code>x</code> has type <code><code><a href="V.html#v:IOVector">IOVector</a></code>
 <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-C-Types.html#t:CInt">CInt</a></code></code>.</p></div></div><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:VecCtx" class="def">VecCtx</a> a <span class="keyword">where</span> <a href="#t:VecCtx" class="selflink">#</a></p><div class="doc"><p>Type class used to implement the anti-quoters in <code><a href="Language-C-Inline-Context.html#v:vecCtx">vecCtx</a></code>.</p></div><div class="subs minimal"><p class="caption">Minimal complete definition</p><p class="src"><a href="Language-C-Inline-Context.html#v:vecCtxLength">vecCtxLength</a>, <a href="Language-C-Inline-Context.html#v:vecCtxUnsafeWith">vecCtxUnsafeWith</a></p></div><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a id="t:VecCtxScalar" class="def">VecCtxScalar</a> a :: <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Kind.html#t:-42-">*</a> <a href="#t:VecCtxScalar" class="selflink">#</a></p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:vecCtxLength" class="def">vecCtxLength</a> :: a -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Int.html#t:Int">Int</a> <a href="#v:vecCtxLength" class="selflink">#</a></p><p class="src"><a id="v:vecCtxUnsafeWith" class="def">vecCtxUnsafeWith</a> :: a -&gt; (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-Ptr.html#t:Ptr">Ptr</a> (<a href="Language-C-Inline-Context.html#t:VecCtxScalar">VecCtxScalar</a> a) -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/System-IO.html#t:IO">IO</a> b) -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/System-IO.html#t:IO">IO</a> b <a href="#v:vecCtxUnsafeWith" class="selflink">#</a></p></div><div class="subs instances"><p id="control.i:VecCtx" class="caption collapser" onclick="toggleSection('i:VecCtx')">Instances</p><div id="section.i:VecCtx" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:VecCtx:VecCtx:1" class="instance expander" onclick="toggleSection('i:ic:VecCtx:VecCtx:1')"></span> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-Storable.html#t:Storable">Storable</a> a =&gt; <a href="Language-C-Inline-Context.html#t:VecCtx">VecCtx</a> (<a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable.html#t:Vector">Vector</a> a)</span> <a href="#t:VecCtx" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:VecCtx:VecCtx:1" class="inst-details hide"><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="Language-C-Inline-Context.html#t:VecCtxScalar">VecCtxScalar</a> (<a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable.html#t:Vector">Vector</a> a) :: <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Kind.html#t:-42-">*</a> <a href="#t:VecCtxScalar" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:vecCtxLength">vecCtxLength</a> :: <a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable.html#t:Vector">Vector</a> a -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Int.html#t:Int">Int</a> <a href="#v:vecCtxLength" class="selflink">#</a></p><p class="src"><a href="#v:vecCtxUnsafeWith">vecCtxUnsafeWith</a> :: <a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable.html#t:Vector">Vector</a> a -&gt; (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-Ptr.html#t:Ptr">Ptr</a> (<a href="Language-C-Inline-Context.html#t:VecCtxScalar">VecCtxScalar</a> (<a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable.html#t:Vector">Vector</a> a)) -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/System-IO.html#t:IO">IO</a> b) -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/System-IO.html#t:IO">IO</a> b <a href="#v:vecCtxUnsafeWith" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:VecCtx:VecCtx:2" class="instance expander" onclick="toggleSection('i:ic:VecCtx:VecCtx:2')"></span> <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-Storable.html#t:Storable">Storable</a> a =&gt; <a href="Language-C-Inline-Context.html#t:VecCtx">VecCtx</a> (<a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable-Mutable.html#t:IOVector">IOVector</a> a)</span> <a href="#t:VecCtx" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:VecCtx:VecCtx:2" class="inst-details hide"><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="Language-C-Inline-Context.html#t:VecCtxScalar">VecCtxScalar</a> (<a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable-Mutable.html#t:IOVector">IOVector</a> a) :: <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Kind.html#t:-42-">*</a> <a href="#t:VecCtxScalar" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:vecCtxLength">vecCtxLength</a> :: <a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable-Mutable.html#t:IOVector">IOVector</a> a -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Data-Int.html#t:Int">Int</a> <a href="#v:vecCtxLength" class="selflink">#</a></p><p class="src"><a href="#v:vecCtxUnsafeWith">vecCtxUnsafeWith</a> :: <a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable-Mutable.html#t:IOVector">IOVector</a> a -&gt; (<a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/Foreign-Ptr.html#t:Ptr">Ptr</a> (<a href="Language-C-Inline-Context.html#t:VecCtxScalar">VecCtxScalar</a> (<a href="file:///Library/Haskell/ghc-8.0.1-x86_64/lib/vector-0.11.0.0/doc/html/Data-Vector-Storable-Mutable.html#t:IOVector">IOVector</a> a)) -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/System-IO.html#t:IO">IO</a> b) -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/base-4.9.0.0/System-IO.html#t:IO">IO</a> b <a href="#v:vecCtxUnsafeWith" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><a id="v:bsCtx" class="def">bsCtx</a> :: <a href="Language-C-Inline-Context.html#t:Context">Context</a> <a href="#v:bsCtx" class="selflink">#</a></p><div class="doc"><p><code><a href="Language-C-Inline-Context.html#v:bsCtx">bsCtx</a></code> serves exactly the same purpose as <code><a href="Language-C-Inline-Context.html#v:vecCtx">vecCtx</a></code>, but only for
 <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.1-x86_64/usr/share/doc/ghc-8.0.1/html/libraries/bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a></code>.  <code>vec-ptr</code> becomes <code>bs-ptr</code>, and <code>vec-len</code> becomes
 <code>bs-len</code>.  You don't need to specify the type of the pointer in
 <code>bs-ptr</code>, it will always be <code>char*</code>.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.2</p></div></body></html>